@model FlockStudy.Models.ViewModels.PrayerDashboardViewModel
@{
    ViewData["Title"] = "Prayer Dashboard";
}

<div class="mx-auto max-w-7xl p-4">
    <!-- Header -->
    <div class="mb-6 flex flex-col items-center justify-between gap-4 sm:flex-row">
        <a asp-controller="prayer" asp-action="create" class="inline-flex items-center rounded-lg bg-blue-600 px-4 py-2 text-white hover:bg-blue-700">
            <i class="fas fa-plus"></i> New Prayer Request
        </a>
        <button type="button"
                data-modal-target="logoutModal"
                data-modal-toggle="logoutModal"
                class="inline-flex items-center rounded-lg bg-red-600 px-4 py-2 text-white hover:bg-red-700">
            <svg class="h-6 w-6 text-red-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H8m12 0-4 4m4-4-4-4M9 4H7a3 3 0 0 0-3 3v10a3 3 0 0 0 3 3h2" />
            </svg> 
        </button>
    </div>

    <!-- My Commitments This Week -->
    <section class="mb-8">
        <h4 class="mb-3 text-lg font-semibold text-gray-700">My Prayer Commitments This Week</h4>

        @if (!Model.MyCommitments.Any())
        {
            <div class="rounded-lg bg-blue-50 p-4 text-blue-700">
                You haven't committed to any prayers this week. Browse available requests below!
            </div>
        }
        else
        {
            <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
                @foreach (var request in Model.MyCommitments)
                {
                    <div class="rounded-lg border bg-white p-4 shadow-sm @(request.IsCompletedThisWeek ? "border-green-500" : "border-gray-200")">
                        <h6 class="font-semibold text-gray-800">@request.Title</h6>
                        <p class="mt-1 text-sm text-gray-600">@request.Description</p>
                        <small class="text-xs text-gray-500">Requested by: @request.RequestedBy</small>
                        <div class="mt-3">
                            <form method="post" action="/Home/MarkCompleted" class="inline">
                                <input type="hidden" name="prayerRequestId" value="@request.Id" />
                                <button type="submit" class="inline-flex items-center gap-2 rounded-md border px-3 py-1 text-sm font-medium @(request.IsCompletedThisWeek ? "bg-green-500 text-white border-green-500 hover:bg-green-600" : "border-green-500 text-green-500 hover:bg-green-50")">
                                    <i class="fas @(request.IsCompletedThisWeek ? "fa-check-circle" : "fa-circle")"></i>
                                    @(request.IsCompletedThisWeek ? "Prayed ✓" : "Mark as Prayed")
                                </button>
                            </form>
                        </div>
                    </div>
                }
            </div>
        }
    </section>

    <!-- Available Prayer Requests -->
    <section class="mb-8">
        <h4 class="mb-3 text-lg font-semibold text-gray-700">Available Prayer Requests</h4>

        @if (!Model.AvailableRequests.Any())
        {
            <div class="rounded-lg bg-blue-50 p-4 text-blue-700">
                No prayer requests available right now.
            </div>
        }
        else
        {
            <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
                @foreach (var request in Model.AvailableRequests)
                {
                    <div class="rounded-lg border border-gray-200 bg-white p-4 shadow-sm">
                        <h6 class="font-semibold text-gray-800">@request.Title</h6>
                        <p class="mt-1 text-sm text-gray-600">@request.Description</p>
                        <small class="block text-xs text-gray-500">Requested by: @request.RequestedBy</small>
                        <small class="text-xs text-gray-500">@request.CommitmentCount people praying</small>
                        <div class="mt-3">
                            @if (!request.IsCommittedByCurrentUser)
                            {
                                <form method="post" action="/Home/CommitToPrayer" class="inline">
                                    <input type="hidden" name="prayerRequestId" value="@request.Id" />
                                    <button type="submit" class="inline-flex items-center gap-2 rounded-md bg-blue-600 px-3 py-1 text-sm font-medium text-white hover:bg-blue-700">
                                        <i class="fas fa-hands-praying"></i> Commit to Pray
                                    </button>
                                </form>
                            }
                            else
                            {
                                <span class="inline-block rounded-full bg-green-100 px-3 py-1 text-xs font-medium text-green-700">
                                    Already committed
                                </span>
                            }
                        </div>
                    </div>
                }
            </div>
        }
    </section>

    <!-- My Prayer Requests -->
    <section>
        <h4 class="mb-3 text-lg font-semibold text-gray-700">My Prayer Requests</h4>

        @if (!Model.MyRequests.Any())
        {
            <div class="rounded-lg bg-blue-50 p-4 text-blue-700">
                You haven't created any prayer requests yet.
            </div>
        }
        else
        {
            <div class="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
                @foreach (var request in Model.MyRequests)
                {
                    <div class="rounded-lg border border-blue-400 bg-white p-4 shadow-sm">
                        <h6 class="font-semibold text-gray-800">@request.Title</h6>
                        <p class="mt-1 text-sm text-gray-600">@request.Description</p>
                        <small class="mt-2 flex items-center gap-1 text-xs text-green-600">
                            <i class="fas fa-users"></i> @request.CommitmentCount people praying for this
                        </small>
                    </div>
                }
            </div>
        }
    </section>
</div>
